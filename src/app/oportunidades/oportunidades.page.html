<div class="header-container">
  
  <!-- Título y Ruta -->
  <div class="seguimiento-info">
    <div class="info-container">
      <div class="info-item">
        <span class="info-label">Nombre:</span>
        <span class="info-value">{{seguimientoSeleccionado.codigo}} - {{seguimientoSeleccionado.nombre}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Plantas:</span>
        <span class="info-value">
          <span *ngFor="let planta of seguimientoSeleccionado.plantasAsociadas; let last = last">
            {{planta.nombrePlanta}}{{!last ? ', ' : ''}}
          </span>
        </span>
      </div>
      <div class="info-item">
        <span class="info-label">Fecha:</span>
        <span class="info-value">{{seguimientoSeleccionado.fechaInicio | date:'dd/MM/yyyy'}} - {{seguimientoSeleccionado.fechaFin | date:'dd/MM/yyyy'}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Estado:</span>
        <span class="info-value">{{seguimientoSeleccionado.estadoSeguimientoPlanta}}</span>
      </div>
    </div>
  </div>
  <!-- Encabezado Principal -->
  <div class="header-content">
    <div class="title-section">
      <h1 class="page-title">Oportunidades Comerciales</h1>
    </div>

        <!-- Botones y Selector -->
        <div class="action-section">
          <!-- <app-cliente-search style="margin-top: -5px;" (clienteSeleccionado)="onClienteChange($event)"></app-cliente-search> -->
          <button class="btn add-btn" (click)="showModal()">
            <i class="pi pi-briefcase"></i>
            Agregar
          </button>
        </div>

    </div>
  </div>

              <!-- Tabla de Clientes -->
<div class="table-container">
  <p-table 
    [value]="listaOportunidades" 
    [loading]="loading"
    [paginator]="true" 
    [rows]="10"
    [showCurrentPageReport]="true"
    [rowsPerPageOptions]="[10,25,50]"
    styleClass="p-datatable-sm p-datatable-striped"
    [loading]="loading"
    [sortMode]="'multiple'"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} Oportunidades">

    <!-- Header de la tabla -->
    <ng-template pTemplate="header">
      <tr>
        <th colspan="10" class="table-header">
          <ion-icon name="people"></ion-icon>
          LISTA DE OPORTUNIDADES COMERCIALES
        </th>
      </tr>
      <tr>
        <th pSortableColumn="fechaRegistro">
          Fecha
        </th>
        <th pSortableColumn="ClienteText">
          Planta
          <p-sortIcon field="ClienteText"></p-sortIcon>
          <p-columnFilter type="text" field="ClienteText" display="menu"></p-columnFilter>
        </th>
        <th pSortableColumn="LineaText">
          Canal
        </th>
        <th pSortableColumn="fechaCompromiso">
          Ubicacion
        </th>
        <th pSortableColumn="frecuenciaText">
          Cliente
          <p-sortIcon field="ClienteText"></p-sortIcon>
          <p-columnFilter type="text" field="ClienteText" display="menu"></p-columnFilter>
        </th>
        <th >
          Contacto
        </th>
        <th >
          Toneladas
        </th>
        <th >
          Gerente de Zona
        </th>
        <th>
          Compromiso
        </th>
        <th></th>
      </tr>
    </ng-template>

    <!-- Cuerpo de la tabla -->
    <ng-template pTemplate="body" let-oportunidad>
      <tr>
        <td>{{(oportunidad.fecha) | date:'dd/MM/yyyy'}}</td>
        <td>{{oportunidad.nombrePlanta}}</td>
        <td>{{oportunidad.nombreCanalCliente}}</td>
        <td>{{oportunidad.nombreDepartamentoCCliente}} - {{oportunidad.nombreMunicipioCliente}}</td>
        <td>{{oportunidad.nombreCliente}}</td>
        <td>{{oportunidad.contacto}}</td>
        <td>{{oportunidad.tonelada}}</td>
        <td>{{oportunidad.nombreGerenteZona}} {{oportunidad.apellidoGerenteZona}}</td>
        <td>{{oportunidad.compromisoGerenteZona}}</td>

        <td class="actions-cell">
          <div class="action-buttons">
            <button pButton 
              type="button" 
              icon="pi pi-pencil" 
              pTooltip="Editar"
              tooltipPosition="top"
              class="p-button-rounded p-button-primary p-button-sm"
              (click)="editarOportunidad(oportunidad)">
            </button>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

  <p-dialog [(visible)]="displayModal" 
             [modal]="true" 
             [responsive]="true" 
             [header]="(edit ? 'Actualizar Oportunidad Comercial' : 'Registrar Oportunidad Comercial') ">
          <ng-template pTemplate="header">
            <div class="dialog-header">
              <i class="pi pi-briefcase"></i>
              <span>{{edit ? 'Actualizar Oportunidad Comercial' : 'Registrar Oportunidad Comercial'}}</span>
            </div>
          </ng-template>

          <form [formGroup]="OportunidadForm">
            <ion-grid>
              <ion-row>        
                <ion-col size="12" size-sm="6" size-lg="6">
                  <p-floatLabel>
                    <p-dropdown 
                      id="planta"
                      [options]="seguimientoPlantas"
                      optionLabel="nombrePlanta"
                      formControlName="idPlanta"
                      optionValue="idPlanta"
                      [showClear]="true"
                      placeholder="Seleccione la Planta"
                      (onChange)="onPlantaChange($event)">
                    </p-dropdown>
                  <label for="planta">Planta</label>
                  </p-floatLabel>
                </ion-col>
        
                <ion-col size="12" size-sm="6" size-lg="6">
                    <p-floatLabel>
                      <p-dropdown 
                      id="linea"
                      [options]="seguimientoLineas"
                      optionLabel="nombreLinea"
                      formControlName="idLinea"
                      optionValue="idLinea"
                      [showClear]="true"
                      placeholder="Seleccione la Línea">
                      </p-dropdown>
                      <label for="linea">Línea</label>
                    </p-floatLabel>
                </ion-col>
              </ion-row>
              <ion-row class="form-row">
                <ion-col size="12" size-md="6" style="margin-top: -1rem;">
                  <app-cliente-search (clienteSeleccionado)="onClienteChange($event)" formControlName="idCliente"></app-cliente-search>
                </ion-col>

                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <input pInputText [value]="selectedCliente?.canallistaText" readonly>
                    <label>Canal</label>
                  </span>
                </ion-col>
              </ion-row>

              <ion-row class="form-row">
                
                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <p-inputNumber formControlName="tonelada" mode="decimal"></p-inputNumber>
                    <label>Toneladas</label>
                  </span>
                </ion-col>
                
                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <textarea pInputTextarea formControlName="contacto" rows="4" maxlength="100"></textarea>
                    <label>Contacto</label>
                  </span>
                </ion-col>
              </ion-row>

              <ion-row class="form-row">
                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <p-dropdown 
                    [options]="listaGerenteZona" 
                    optionLabel="nombreCompleto" 
                    optionValue="id"
                    formControlName="idGerenteZona"
                    placeholder="Seleccione un  Gerente Zona">
                    </p-dropdown>
                    <label>Gerente Zona</label>
                  </span>
                </ion-col>

                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <textarea pInputTextarea formControlName="compromisoGerenteZona" rows="4" maxlength="200"></textarea>
                    <label>Compromiso Gerente Zona</label>
                  </span>
                </ion-col>  

              </ion-row>

              <!-- Botones -->
              <ion-row class="button-row">
                <ion-col>
                  <div class="button-container">
                    <button pButton 
                            type="submit" 
                            [label]="edit ? 'Actualizar' : 'Guardar'"
                            class="p-button-primary action-button"
                            [disabled]="!OportunidadForm.valid"
                            (click)="edit ? actualizarOportunidad() : RegistrarOportunidad()">
                    </button>
                    <button pButton 
                            type="button" 
                            label="Cancelar" 
                            class="p-button-secondary action-button" 
                            (click)="closeModal()">
                    </button>
                  </div>
                </ion-col>
              </ion-row>

          
 
            </ion-grid>

          </form>
</p-dialog>

    <!-- Confirm Dialog -->
    <p-confirmDialog 
      header="Confirmación" 
      icon="pi pi-exclamation-triangle"
      acceptLabel="Sí"
      rejectLabel="No">
    </p-confirmDialog>
