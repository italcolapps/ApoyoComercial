<div class="header-container">

  <div class="seguimiento-info">
    <div class="info-container">
      <div class="info-item">
        <span class="info-label">Nombre:</span>
        <span class="info-value">{{seguimientoSeleccionado.codigo}} - {{seguimientoSeleccionado.nombre}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Plantas:</span>
        <span class="info-value">
          <span *ngFor="let planta of seguimientoSeleccionado.plantasAsociadas; let last = last">
            {{planta.nombrePlanta}}{{!last ? ', ' : ''}}
          </span>
        </span>
      </div>
      <div class="info-item">
        <span class="info-label">Fecha:</span>
        <span class="info-value">{{seguimientoSeleccionado.fechaInicio | date:'dd/MM/yyyy'}} - {{seguimientoSeleccionado.fechaFin | date:'dd/MM/yyyy'}}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Estado:</span>
        <span class="info-value">{{seguimientoSeleccionado.estadoSeguimientoPlanta}}</span>
      </div>
    </div>
  </div>


  <!-- Encabezado Principal -->
  <div class="header-content">

    <div class="title-section">
      <h1 class="page-title">Visita de Clientes</h1>
    </div>

        <!-- Botones y Selector -->
        <div class="action-section">
          <button class="btn add-btn" (click)="showModal()">
            <i class="pi pi-user-plus"></i>
            Agregar
          </button>
        </div>

    </div>
  </div>

            <!-- Tabla de Clientes -->
<div class="table-container">
  <p-table 
    [value]="listaVisitaClientes" 
    [loading]="loading"
    [paginator]="true" 
    [rows]="10"
    [showCurrentPageReport]="true"
    [rowsPerPageOptions]="[10,25,50]"
    styleClass="p-datatable-sm p-datatable-striped"
    [loading]="loading"
    [sortMode]="'multiple'"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} Seguimientos">

    <!-- Header de la tabla -->
    <ng-template pTemplate="header">
      <tr>
        <th colspan="12" class="table-header">
          <ion-icon name="people"></ion-icon>
          LISTADO DE VISITAS DE CLIENTES
        </th>
      </tr>
      <tr>
        <th pSortableColumn="fechaRegistro">
          F Registro
        </th>
        <th pSortableColumn="fechaRegistro">
          F Visita
        </th>
        <th pSortableColumn="ClienteText">
          Cliente
          <p-sortIcon field="ClienteText"></p-sortIcon>
          <p-columnFilter type="text" field="ClienteText" display="menu"></p-columnFilter>
        </th>
        <th pSortableColumn="LineaText">
          Linea
        </th>
        <th pSortableColumn="toneladas">
          Toneladas
        </th>
        <th>
          Actividad
        </th>
        <th>
          Comp Gte Zona
        </th>
        <th>
          Comp Dir
        </th>
        <th>
          Informacion
        </th>
        <th pSortableColumn="frecuenciaText">
          Frecuencia
        </th>
        <th pSortableColumn="fechaCompromiso">
          Compromiso
        </th>
        <th></th>
      </tr>
    </ng-template>

    <!-- Cuerpo de la tabla -->
    <ng-template pTemplate="body" let-segCliente>
      <tr>
        <td>{{segCliente.fechaRegistro | date:'dd/MM/yyyy'}}</td>
        <td>{{segCliente.fechaVisita | date:'dd/MM/yyyy'}}</td>
        <td>{{segCliente.nombreCliente}}</td>
        <td>
          <span *ngFor="let linea of segCliente.lineasCliente; let last = last">
              {{linea}}{{!last ? ', ' : ''}}
          </span>
      </td>
        <td>{{segCliente.toneladas}}</td>
        <td>{{segCliente.actividadRealizada}}</td>
        <td>{{segCliente.compromisoGerenteZona}}</td>
        <td>{{segCliente.compromisoDirector}}</td>
        <td>{{segCliente.calidadInformacion}}</td>
        <td>{{segCliente.frecuenciaText}}</td>
        <td>{{segCliente.fechaCompromiso | date:'dd/MM/yyyy'}}</td>
        <td class="actions-cell">
          <div class="action-buttons">
            <button pButton 
              type="button" 
              icon="pi pi-pencil" 
              pTooltip="Editar"
              tooltipPosition="top"
              class="p-button-rounded p-button-primary p-button-sm"
              (click)="editarVisitaCliente(segCliente)">
            </button>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog [(visible)]="displayModal" 
          [modal]="true" 
          [responsive]="true" 
          [header]="(edit ? 'Actualizar Visita de Cliente' : 'Crear Visita de Cliente') ">
          <ng-template pTemplate="header">
            <div class="dialog-header">
              <i class="pi pi-building"></i>
              <span>{{edit ? 'Actualizar Visita de Cliente' : 'Crear Visita de Cliente'}}</span>
            </div>
          </ng-template>

          <form [formGroup]="VisitaClientesForm">
            <ion-grid>
              <ion-row class="form-row">

                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <p-calendar formControlName="fechaVisita" 
                    [showIcon]="true"
                    [showOnFocus]="false">
                  </p-calendar>
                    <label>Fecha Visita</label>
                  </span>
                </ion-col>

                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <p-dropdown 
                    formControlName="idGerenteZona" 
                    [options]="listaGerenteZona" 
                    optionLabel="nombreCompleto" 
                    optionValue="id" 
                    [style]="{'width':'210px'}"
                    placeholder="Seleccione un  Gerente Zona">
                    </p-dropdown>
                    <label>Gerente Zona</label>
                  </span>
                </ion-col>

              </ion-row>

              <ion-row class="form-row">
                <ion-col size="12" size-md="6" style="margin-top: -1rem;">
                  <app-cliente-search (clienteSeleccionado)="onClienteChange($event)" formControlName="idCliente"></app-cliente-search>
                </ion-col>

                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <input pInputText [value]="selectedCliente?.tipoClienteText" readonly>
                    <label>Tipo Cliente</label>
                  </span>
                </ion-col>

              </ion-row>

              <!-- <ion-row class="form-row">
                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <input pInputText [value]="seguimientoSeleccionado?.nombre" readonly>
                    <label>Seguimiento de Planta</label>
                  </span>
                </ion-col>

              </ion-row> -->
          
              <ion-row class="form-row" style="margin-bottom: 10px;">
                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <input pInputText [value]="getLineasNames()" readonly>
                    <label>Lineas</label>
                  </span>
                </ion-col>

                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <p-inputNumber formControlName="toneladas" mode="decimal"></p-inputNumber>
                    <label>Toneladas</label>
                  </span>
                </ion-col>
              </ion-row>

              <ion-row class="form-row">

                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <textarea pInputTextarea formControlName="actividadRealizada" rows="4"></textarea>
                    <label>Actividad Realizada</label>
                  </span>
                </ion-col>

                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <textarea pInputTextarea formControlName="compromisoGerenteZona" rows="4"></textarea>
                    <label>Compromiso Gerente Zona</label>
                  </span>
                </ion-col>  
              </ion-row>

              <ion-row class="form-row">

                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <textarea pInputTextarea formControlName="compromisoDirector" rows="4"></textarea>
                    <label>Compromiso Director</label>
                  </span>
                </ion-col>


                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <textarea pInputTextarea formControlName="calidadInformacion" rows="4"></textarea>
                    <label>Calidad Información</label>
                  </span>
                </ion-col>
              </ion-row>

              <ion-row class="form-row">
                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <p-dropdown 
                    formControlName="frecuenciaLista" 
                    [options]="listaFrecuencia" 
                    optionLabel="nombre" 
                    optionValue="id" 
                    [style]="{'width': '12rem'}"
                    placeholder="Seleccione frecuencia">
                    </p-dropdown>
                    <label>Frecuencia</label>
                  </span>
                </ion-col>

                <ion-col size="12" size-md="6">
                  <span class="p-float-label">
                    <p-calendar formControlName="fechaCompromiso" 
                    [showIcon]="true"
                    [showOnFocus]="false">
                  </p-calendar>
                    <label>Fecha Compromiso</label>
                  </span>
                </ion-col>
              </ion-row>

                    <!-- Botones -->
      <ion-row class="button-row">
        <ion-col>
          <div class="button-container">
            <button pButton 
                    type="submit" 
                    [label]="edit ? 'Actualizar' : 'Guardar'"
                    class="p-button-primary action-button"

                    (click)="edit ? actualizarVisitaCliente() : RegistrarVisitaCliente()">
            </button>
            <button pButton 
                    type="button" 
                    label="Cancelar" 
                    class="p-button-secondary action-button" 
                    (click)="closeModal()">
            </button>
          </div>
        </ion-col>
      </ion-row>
            </ion-grid>
        </form>
</p-dialog>

<!-- Confirm Dialog -->
<p-confirmDialog 
  header="Confirmación" 
  icon="pi pi-exclamation-triangle"
  acceptLabel="Sí"
  rejectLabel="No">
</p-confirmDialog>
